{% load socialaccount %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Movie Recommendations</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.1.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8ffe5;
            color: #333333;
            position: relative;
            margin: 0;
            padding: 0;
            height: 100vh;
        }
        .jumbotron {
            background-color: #f8ffe5;
            color: #000;
            text-align: center;
            padding: 2rem 1rem;
            margin-bottom: 0;
            border: none;
        }
        .jumbotron h1,
        .jumbotron p {
            margin: 0;
        }
        .card {
            background-color: #f8ffe5;
            margin-top: 20px;
            border: none;
            border-radius: 0;
            position: relative; /* This is needed for the absolute positioning of the button */
        }
        .card img {
            max-width: 100%;
            height: auto;
            border-radius: 5px;
        }
        .card-rating {
            font-size: 0.9rem;
            color: #6c757d;
        }
        .card-title {
            margin-top: 10px;
            font-size: 1rem;
        }
        .btn-primary {
            background-color: #ef476f; /* Pink */
            border-color: #ef476f;
            color: #ffffff; /* White text */
            padding: 10px 20px;
            border-radius: 5px;
        }
        .btn-primary:hover {
            background-color: #d6406c; /* Darker shade of pink for hover effect */
            border-color: #d6406c;
        }
        .btn-secondary {
            background-color: #ffc43d;
            border-color: #ffc43d;
            color: #ffffff;
            position: fixed;
            top: 0;
            right: 10px;
            padding: 6px 10px;
        }
        .btn-secondary-2 {
            background-color: #ffc43d;
            border-color: #ffc43d;
            color: #ffffff;
            position: fixed;
            top: 0;
            right: 100px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: calc(100% - 130px);
            padding: 6px 10px;
        }
        .btn-secondary:hover {
            background-color: #e0b837;
            border-color: #e0b837;
        }
        .btn-secondary-2:hover {
            background-color: #e0b837;
            border-color: #e0b837;
        }
        .recommendation-text {
            text-align: center;
            padding: 10px;
            max-width: 600px;
            margin: auto;
        }
        .btn-overlay {
            position: absolute;
            top: 10px; /* Positioning from the top */
            right: 10px; /* Positioning from the right */
            background-color: #ef476f;
            border: none;
            color: white;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            z-index: 10; /* Ensure it's on top of other content */
        }
        .btn-overlay:hover {
            background-color: #d6406c;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="row mb-4">
            {% if user.is_authenticated %}
                <div class="col-auto">
                    <a href="{% url 'users:userinfo' %}" class="btn btn-secondary-2" id="user-button">{{ user.first_name }}</a>
                </div>
                <div class="col-auto">
                    <a href="{% url 'users:logout' %}" class="btn btn-secondary">Logout</a>
                </div>
            {% else %}
                <div class="col-auto">
                    <a href="{% provider_login_url 'google' %}?next={% url 'users:home' %}" class="btn btn-secondary-2">Login With Google</a>
                </div>
            {% endif %}
        </div>

        <div class="jumbotron">
            <h1 class="display-4">Movie Recommendations</h1>
        </div>

        <div class="text-center mt-1 mb-4">
            <p class="recommendation-text">Discover movies you'll love with personalized recommendations based on your viewing history and custom filters. Our AI technology analyzes your preferences to suggest the perfect films for your unique taste, making movie night easier and more enjoyable than ever.</p>
        </div>

        <div class="text-center mb-4">
            <a href="{% url 'users:movie_recommendation' %}" class="btn btn-primary">Continue to Movie Recommendations</a>
        </div>

        <div class="row mt-4">
            <div class="col">
                <h2 class="mb-4">Trending Movies</h2>
                <div class="row">
                    {% for movie in trending_movies %}
                        <div class="col-md-2 mb-4">
                            <div class="card">
                                <img src="https://image.tmdb.org/t/p/w500{{ movie.poster_path }}" class="card-img-top" alt="{{ movie.title }}">
                                <button class="btn-overlay add-to-wishlist" data-movie-id="{{ movie.id }}">+</button>
                                <h5 class="card-title">{{ movie.title }}</h5>
                                <p class="card-rating">Rating: {{ movie.vote_average|floatformat:1 }}</p>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        document.querySelectorAll('.add-to-wishlist').forEach(function(button) {
            button.addEventListener('click', function() {
                var movieId = this.getAttribute('data-movie-id');

                {% if user.is_authenticated %}
                    fetch("{% url 'users:add_to_wishlist' %}", {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': '{{ csrf_token }}'
                        },
                        body: JSON.stringify({ movie_id: movieId })
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            alert('Movie added to your wishlist');
                        } else {
                            alert('An error occurred: ' + data.message);
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        alert('An error occurred');
                    });
                {% else %}
                    alert('You need to log in to add the movie to your wishlist');
                {% endif %}
            });
        });
    });
    </script>
</body>
</html>
